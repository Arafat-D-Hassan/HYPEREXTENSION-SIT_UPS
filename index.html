<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hyperextension Sit-Up Tracker</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, #1e1e2f, #2a2a40);
    color: white;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    font-size: 2em;
    margin-bottom: 15px;
    letter-spacing: 1px;
    color: #f0f0f0;
  }
  .container {
    max-width: 900px;
    margin: auto;
  }
  .top-bar {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 15px;
    gap: 10px;
  }
  .top-bar button {
    padding: 8px 14px;
    background: rgba(255,255,255,0.08);
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    backdrop-filter: blur(12px);
    transition: background 0.3s ease;
  }
  .top-bar button:hover {
    background: rgba(255,255,255,0.15);
  }
  /* Scoreboard */
  .stats {
    display: flex;
    justify-content: space-around;
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(15px);
    margin-bottom: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  }
  .stat-box {
    text-align: center;
  }
  .stat-label {
    font-size: 0.9em;
    color: rgba(255,255,255,0.7);
  }
  .stat-value {
    font-size: 1.5em;
    font-weight: bold;
    color: #ffcc66;
  }
  /* Timeline list (simple) */
  #timelineList {
    max-height: 400px;
    overflow-y: auto;
    background: rgba(255,255,255,0.05);
    padding: 10px;
    border-radius: 12px;
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255,255,255,0.15);
  }
  .timeline-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .timeline-item:last-child {
    border-bottom: none;
  }
  .timeline-item img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 1.5px solid rgba(255, 204, 102, 0.8);
  }
  .timeline-info {
    flex: 1;
  }
  /* Entry form */
  .day-entry {
    background: rgba(255, 255, 255, 0.05);
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(15px);
  }
  .day-entry label {
    display: block;
    margin-top: 10px;
  }
  input[type="number"], input[type="file"], input[type="date"] {
    margin-top: 5px;
    padding: 8px;
    border-radius: 8px;
    border: none;
    outline: none;
    background: rgba(255, 255, 255, 0.12);
    color: white;
    width: 100%;
    box-sizing: border-box;
  }
  button.save {
    margin-top: 10px;
    padding: 8px 15px;
    background: linear-gradient(135deg, #28a745, #34d058);
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    font-weight: bold;
    transition: background 0.3s ease;
    width: 100%;
  }
  button.save:hover {
    background: linear-gradient(135deg, #218838, #2db34c);
  }
  /* History grid */
  .history {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
  }
  .history-item {
    flex: 1 1 calc(33% - 10px);
    background: rgba(255,255,255,0.05);
    border-radius: 10px;
    padding: 10px;
    border: 1px solid rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    cursor: pointer;
    transition: transform 0.3s ease;
  }
  .history-item:hover {
    transform: scale(1.05);
  }
  .history-item img {
    width: 100%;
    border-radius: 8px;
  }
  /* Modal */
  #photoEditModal {
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.85);
    display:none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #modalContent {
    position: relative;
    max-width: 90vw;
    max-height: 90vh;
    background: #222;
    border-radius: 12px;
    padding: 10px;
    box-shadow: 0 0 15px #000;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #modalImage {
    max-width: 100%;
    max-height: 70vh;
    border-radius: 8px;
    cursor: zoom-in;
    transition: transform 0.3s ease;
  }
  #modalImage.zoomed {
    cursor: zoom-out;
    transform: scale(2);
  }
  #modalFileInput {
    margin-top: 10px;
  }
  #modalButtons {
    margin-top: 12px;
    display: flex;
    gap: 10px;
  }
  #modalButtons button {
    padding: 8px 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  #modalSaveBtn {
    background: #28a745;
    color: white;
  }
  #modalCloseBtn {
    background: #d33;
    color: white;
  }
</style>
</head>
<body>

<h1>Hyperextension Sit-Up Tracker</h1>
<div class="container">

  <div class="top-bar">
    <button id="btnTimeline">Timeline</button>
    <button id="btnHistory">Show All History</button>
  </div>

  <div class="stats">
    <div class="stat-box">
      <div class="stat-label">Highest Record</div>
      <div class="stat-value" id="highest">0</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Average Reps</div>
      <div class="stat-value" id="average">0</div>
    </div>
    <div class="stat-box">
      <div class="stat-label">Total Score</div>
      <div class="stat-value" id="total">0</div>
    </div>
  </div>

  <div id="content"></div>
</div>

<!-- Modal for photo zoom and edit -->
<div id="photoEditModal">
  <div id="modalContent">
    <img id="modalImage" src="" alt="Zoomed Photo" />
    <input type="file" id="modalFileInput" accept="image/*" />
    <div id="modalButtons">
      <button id="modalSaveBtn">Save Changes</button>
      <button id="modalCloseBtn">Close</button>
    </div>
  </div>
</div>

<script>
  // Records array: {date: "YYYY-MM-DD", reps: number, photo: base64 string}
  let records = JSON.parse(localStorage.getItem("situpRecordsWithPhotos")) || [];

  // DOM elements
  const highestEl = document.getElementById("highest");
  const averageEl = document.getElementById("average");
  const totalEl = document.getElementById("total");
  const contentEl = document.getElementById("content");

  const btnTimeline = document.getElementById("btnTimeline");
  const btnHistory = document.getElementById("btnHistory");

  // Modal elements
  const modal = document.getElementById("photoEditModal");
  const modalImage = document.getElementById("modalImage");
  const modalFileInput = document.getElementById("modalFileInput");
  const modalSaveBtn = document.getElementById("modalSaveBtn");
  const modalCloseBtn = document.getElementById("modalCloseBtn");

  let currentEditIndex = null;

  // Utility: save records to localStorage and update stats
  function saveData() {
    localStorage.setItem("situpRecordsWithPhotos", JSON.stringify(records));
    updateStats();
  }

  // Calculate and update scoreboard
  function updateStats() {
    if (records.length === 0) {
      highestEl.textContent = 0;
      averageEl.textContent = 0;
      totalEl.textContent = 0;
      return;
    }
    const repsArray = records.map(r => r.reps || 0);
    const highest = Math.max(...repsArray);
    const validReps = repsArray.filter(r => r > 0);
    const average = validReps.length ? (validReps.reduce((a,b) => a+b,0)/validReps.length).toFixed(1) : 0;
    const total = repsArray.reduce((a,b) => a+b, 0);

    highestEl.textContent = highest;
    averageEl.textContent = average;
    totalEl.textContent = total;
  }

  // Show Timeline view (simple list + entry form)
  function showTimeline() {
    contentEl.innerHTML = "";

    // Entry form
    const today = new Date().toISOString().split("T")[0];
    const formDiv = document.createElement("div");
    formDiv.className = "day-entry";
    formDiv.innerHTML = `
      <label for="dateInput"><strong>Select Date:</strong></label>
      <input type="date" id="dateInput" value="${today}" max="${today}" />
      <label for="repsInput">Reps:</label>
      <input type="number" id="repsInput" min="0" />
      <label for="photoInput">Photo:</label>
      <input type="file" id="photoInput" accept="image/*" />
      <button class="save" id="saveBtn">Save</button>
    `;
    contentEl.appendChild(formDiv);

    // Prefill form if record exists
    const dateInput = formDiv.querySelector("#dateInput");
    const repsInput = formDiv.querySelector("#repsInput");
    const photoInput = formDiv.querySelector("#photoInput");

    function loadForm(date) {
      const rec = records.find(r => r.date === date);
      if (rec) {
        repsInput.value = rec.reps || "";
      } else {
        repsInput.value = "";
      }
    }

    loadForm(today);

    dateInput.addEventListener("change", () => {
      loadForm(dateInput.value);
    });

    // Save button event
    formDiv.querySelector("#saveBtn").addEventListener("click", () => {
      const date = dateInput.value;
      if (!date) {
        alert("Please select a date.");
        return;
      }
      const reps = parseInt(repsInput.value);
      if (isNaN(reps) || reps < 0) {
        alert("Please enter a valid number of reps.");
        return;
      }

      function saveRecord(photoData) {
        const existingIndex = records.findIndex(r => r.date === date);
        if (existingIndex >= 0) {
          // Update existing record
          records[existingIndex].reps = reps;
          if (photoData !== null) records[existingIndex].photo = photoData;
        } else {
          // New record
          records.push({ date, reps, photo: photoData || "" });
        }
        saveData();
        alert("Saved!");
        showTimeline(); // Refresh timeline list
      }

      if (photoInput.files && photoInput.files[0]) {
        const reader = new FileReader();
        reader.onload = e => {
          saveRecord(e.target.result);
        };
        reader.readAsDataURL(photoInput.files[0]);
      } else {
        // Keep existing photo if any or empty string
        const existingPhoto = records.find(r => r.date === date)?.photo || "";
        saveRecord(existingPhoto);
      }
    });

    // Below the form, show simple timeline list (no editing)
    const listDiv = document.createElement("div");
    listDiv.id = "timelineList";
    listDiv.style.marginTop = "20px";

    // Sort records by date ascending
    const sortedRecords = records.slice().sort((a,b) => new Date(a.date) - new Date(b.date));
    sortedRecords.forEach((rec) => {
      const item = document.createElement("div");
      item.className = "timeline-item";

      const thumb = document.createElement("img");
      thumb.src = rec.photo || "";
      thumb.alt = `Photo on ${rec.date}`;

      const infoDiv = document.createElement("div");
      infoDiv.className = "timeline-info";
      infoDiv.innerHTML = `<strong>${rec.date}</strong><br>Reps: ${rec.reps}`;

      item.appendChild(thumb);
      item.appendChild(infoDiv);

      listDiv.appendChild(item);
    });

    contentEl.appendChild(listDiv);
  }

  // Show All History view with grid + edit capability
  function showHistory() {
    contentEl.innerHTML = "";

    const historyDiv = document.createElement("div");
    historyDiv.className = "history";

    // Sort records by date ascending
    const sortedRecords = records.slice().sort((a,b) => new Date(a.date) - new Date(b.date));
    sortedRecords.forEach((rec, idx) => {
      const item = document.createElement("div");
      item.className = "history-item";

      const img = document.createElement("img");
      img.src = rec.photo || "";
      img.alt = `Photo on ${rec.date}`;
      img.title = `Date: ${rec.date}\nReps: ${rec.reps}`;
      img.addEventListener("click", () => openEditModal(idx));

      const info = document.createElement("div");
      info.innerHTML = `<strong>${rec.date}</strong><br>Reps: ${rec.reps}`;

      item.appendChild(img);
      item.appendChild(info);

      historyDiv.appendChild(item);
    });

    contentEl.appendChild(historyDiv);
  }

  // Open modal to zoom and edit photo of a record by index
  function openEditModal(index) {
    currentEditIndex = index;
    const rec = records[index];
    modalImage.src = rec.photo || "";
    modalFileInput.value = "";
    modal.style.display = "flex";
    modalImage.classList.remove("zoomed");
  }

  // Close modal
  modalCloseBtn.onclick = () => {
    modal.style.display = "none";
    currentEditIndex = null;
  };

  // Save changes from modal: update photo if file selected
  modalSaveBtn.onclick = () => {
    if (currentEditIndex === null) return;
    const file = modalFileInput.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = e => {
        records[currentEditIndex].photo = e.target.result;
        saveData();
        modalImage.src = e.target.result;
        alert("Photo updated successfully!");
        modal.style.display = "none";
        currentEditIndex = null;
        // Refresh current view (Timeline or History)
        if (currentView === "history") showHistory();
      };
      reader.readAsDataURL(file);
    } else {
      alert("Please select a photo to update or close the modal.");
    }
  };

  // Zoom toggle on modal image
  modalImage.addEventListener("click", () => {
    modalImage.classList.toggle("zoomed");
  });

  // Track current view for refreshing
  let currentView = "timeline";

  btnTimeline.addEventListener("click", () => {
    currentView = "timeline";
    showTimeline();
  });
  btnHistory.addEventListener("click", () => {
    currentView = "history";
    showHistory();
  });

  // Initialize
  updateStats();
  showTimeline();
</script>

</body>
</html>
